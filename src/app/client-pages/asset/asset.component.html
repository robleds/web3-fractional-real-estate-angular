<div>
  <gallery style="display:none"></gallery>
  <ngx-slick-carousel *ngIf="assetsService.selectedAsset" class="assetpage-carousel" [config]="slideConfig">
    <div ngxSlickItem *ngFor="let image of assetsService.selectedAsset.gallery; let i = index">
      <div [lightbox]="i" [style.background-image]="'url('+ image.src +')'"
           [ngClass]="{'portrait': image.portrait, 'landscape': !image.portrait}" class="bgimg">
      </div>
    </div>
  </ngx-slick-carousel>

  <div *ngIf="assetsService.selectedAsset " class="container-lg">
    <div class="p-grid" *ngIf="assetsService.selectedAsset.offer?.preSale">
      <div class="p-col-12">
        <div fxLayout="row wrap" fxLayoutAlign="space-between center" style="width: 100%">
          <div class="label label-sm" style="margin-bottom: 5px">
            Pré-Venda até: {{assetsService.selectedAsset.offer.preSaleEndDate.toLocaleDateString('pt-BR')}}
          </div>
          <div class="label label-sm" style="margin-bottom: 5px">
            Disponível: {{assetsService.selectedAsset.offer.availableBalance | number: '1.0-2':'pt-BR'}} frações
          </div>
        </div>
        <app-progress *ngIf="progressData" [max]="progressData.total" [value]="progressData.current" color="#fa7600"
                      [targets]="progressData.targets"></app-progress>
      </div>
    </div>

    <div fxLayout.gt-xs="row" fxLayout.lt-sm="column" fxLayoutGap.lt-sm="40px" fxLayoutGap.gt-xs="10px"
         class="layout-on-694">
      <div fxFlex.sm="60" fxFlex.gt-sm="67" fxFlexOrder.gt-xs="1" fxFlexOrder.lt-sm="2" class="info-section">

        <p-breadcrumb [model]="breadcrumb" [home]="home"></p-breadcrumb>

        <h2 class="faded label-sm label" fxLayout="row wrap" fxLayoutAlign="start center" fxLayoutGap="12px">
          <b>{{assetsService.selectedAsset.type}}</b>
          <span>•</span>
          <span fxLayout="column" fxLayoutAlign="center center">
            <div><img src="assets/th-large.svg" style="width: 15px;"/>
              {{assetsService.selectedAsset.totalArea | number: '1.0-0':'pt-BR'}}<span
                style="text-transform: none;">m²</span></div>
            <div style="font-size: 13px;">ÁREA TOTAL</div>
          </span>
          <span>•</span>
          <span fxLayout="column" fxLayoutAlign="center center">
            <div><img src="assets/th-large-solid2.svg" style="width: 15px;"/>
              {{assetsService.selectedAsset.grossLettableArea | number: '1.0-0':'pt-BR'}}<span
                style="text-transform: none;">m²</span></div>
            <div style="font-size: 13px;">ÁREA LOCÁVEL</div>
          </span>
        </h2>

        <div class="black margint-30">
          <h2 class="weight-400 title"><b>{{assetsService.selectedAsset.title}}</b></h2>

          <div>
            <b>{{assetsService.selectedAsset.address.street}}</b>, {{assetsService.selectedAsset.address.number}} -
            {{assetsService.selectedAsset.address.neighborhood}}, {{assetsService.selectedAsset.address.city}} -
            {{assetsService.selectedAsset.address.state}}
          </div>

          <div class="margint-30">
            <div style="margin-bottom: 10px;">
              <span class="weight-600">
                <fa-icon [icon]="['fas','align-left']" style="margin-right: 10px;"></fa-icon>
                Descrição
              </span>
            </div>
            <p [innerText]="assetsService.selectedAsset.description"></p>
          </div>
        </div>
      </div>

      <div fxFlex.sm="40" fxFlex.gt-sm="33" fxFlexOrder.gt-xs="2" fxFlexOrder.lt-sm="1" class="buy-section">
        <div>
          <mat-card class="sticky-card" style="margin-top: 25px;">

            <!-- RENT INFO & PRICE  -->
            <div *ngIf="assetsService.selectedAsset.rented">
              <div style="margin-bottom: 5px" class="label">
              <span class="green">
                <fa-icon [icon]="['fas','check-circle']"></fa-icon>
                Alugado
              </span>
              </div>
            </div>
            <div *ngIf="!assetsService.selectedAsset.rented">
              <div class="label" style="margin-bottom: 5px">
              <span class="accent">
                <fa-icon [icon]="['fas','exclamation-circle']"></fa-icon>
                Não Alugado
              </span>
              </div>
            </div>
            <div class="rent-value" style="margin-bottom: 12px">
            <span class="value label-sm gray"><span>Aluguel Líquido <span *ngIf="!assetsService.selectedAsset.rented">Estimado:</span></span> R$
              {{assetsService.selectedAsset.netRent | number: '1.0-2':'pt-BR'}}</span>
            </div>

            <!-- ASSET MARKET VALUE  -->
            <div *ngIf="assetsService.selectedAsset.offer" class="label-sm gray">
            <span>
              Valor do imóvel
            </span>
              <span class="value break-word">
               <span>R${{(assetsService.selectedAsset.offer.price *
                 parse(assetsService.selectedAsset.supply)) | number:'1.0-0':'pt-BR'}}</span>
            </span>
            </div>

            <!-- FRACTION PRICE -->
            <div *ngIf="assetsService.selectedAsset.offer; else elseBlock">
              <div class="balance-divider" style="margin-top: 20px; ">
                <div class="label" style="font-weight: 700; text-align: center; font-size: 14px;">
                  PREÇO
                </div>
                <div style="font-size: 20px; text-align: center">
                  R${{assetsService.selectedAsset.offer.price | number: '1.0-2':'pt-BR'}}
                  <span style="font-size: 12px;">/ fração</span>
                </div>
              </div>

              <!-- AMOUNT INPUT WITH MIN MAX BTNS -->
              <div fxLayout="column" fxLayoutAlign="center center">
              <span class="p-float-label">
                <p-inputNumber id="inputNumber" inputId="inputNumber" [formControl]="amount" class="shares-input"
                               [step]="1" [min]="assetsService.selectedAsset.offer.lot"
                               [max]="assetsService.selectedAsset.offer.maxHolderShares"
                               [showButtons]="true" [styleClass]="'p-inputtext-lg'"></p-inputNumber>
                <label for="inputNumber">Número de frações</label>
              </span>
                <div style="max-width: 216px; width: 100%; margin-bottom: 8px">
                  <div fxLayout="row" fxLayoutAlign="space-between center">
                    <span class="faded" style="font-size: 12px">Selecionar:</span>
                    <div>
                      <button mat-stroked-button class="min-btn" (click)="selectMin()">
                        Mín: {{assetsService.selectedAsset.offer.lot | number:'1.0-2':'pt-BR'}}
                      </button>
                      <button mat-stroked-button class="max-btn" (click)="selectMax()">
                        Máx: {{findMax() | number:'1.0-2':'pt-BR'}}
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <div fxLayout="column" class="balance-divider animate__animated animate__fadeIn text-center"
                   fxLayoutGap="12px"
                   *ngIf="amount.value !== null">
                <div class="gray" style="font-size: 13px;">
                  <fa-icon [icon]="icons.solid.percentage" class="accent" style="margin-right: 3px"></fa-icon>
                  Você possuirá {{shareOwned}}% do imóvel
                </div>
                <div class="gray" style="font-size: 13px;">
                  <fa-icon [icon]="icons.solid.coins" class="accent" style="margin-right: 3px"></fa-icon>
                  Aluguel mensal <span *ngIf="!assetsService.selectedAsset.rented">estimado</span> rende
                  R$ {{userRent}}
                </div>
                <div class="gray" style="font-size: 13px;">
                  <fa-icon [icon]="icons.solid.chart" class="accent" style="margin-right: 3px"></fa-icon>
                  Retorno estimado sobre investimento {{roi}}%
                </div>
                <div style="font-weight: 600">Custo total: R$ {{totalCost}}</div>
              </div>

              <button mat-flat-button color="primary" class="buybtn" id="buy-btn" (click)="openBuyDialog()"
                      [disabled]="authService.userData.status < 3">
                <b>COMPRAR FRAÇÃO</b>
              </button>
              <div routerLink="/user/update-info/1" *ngIf="authService.userData.status < 3"
                   style="margin-top: 8px; cursor:pointer;"
                   class="error-badge animate__animated animate__fadeInDown animate__faster">
                Validação da conta pendente.
                <br>
                Clique aqui para enviar seus documentos.
              </div>
            </div>
            <ng-template #elseBlock>
              <div class="faded">Nenhuma oferta criada</div>
            </ng-template>
          </mat-card>

          <div *ngIf="assetsService.selectedAsset.offer?.preSale" class="warn-info">
            <fa-icon [icon]="icons.solid.exclamation" class="accent"></fa-icon>
            Este imóvel está em pré-venda. Se a meta não for atingida, a compra não será concluida.
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container-lg">
    <h3 class="faded">Explore a região</h3>
  </div>
  <div>
    <!--    <google-map *ngIf="mapLoaded" [center]="markers[0].position" [zoom]="15" [options]="mapOptions" width="100%" height="350px">-->
    <!--      <map-marker *ngFor="let marker of markers" [title]="marker.title" [position]="marker.position"></map-marker>-->
    <!--    </google-map>-->
  </div>


  <button mat-flat-button color="primary" class="mobile-buy-btn animate__animated animate__fadeInUp"
          (click)="openBuyDialog()" *ngIf="!btnIsVisible">
    <b>Comprar fração </b>
  </button>
</div>
